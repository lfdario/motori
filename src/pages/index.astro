---
// in testa al file NON serve importare nulla per BASE_URL
import Base from "@/layouts/Base.astro";
import ArticleCard from "@/components/ArticleCard.astro";
import { getCollection } from "astro:content";

const latestNews = (await getCollection("news")).sort((a,b) => (b.data.pubDate).localeCompare(a.data.pubDate)).slice(0,8);
const latestTests = (await getCollection("tests")).sort((a,b) => (b.data.pubDate).localeCompare(a.data.pubDate)).slice(0,4);
const latestGuides = (await getCollection("guides")).sort((a,b) => (b.data.pubDate).localeCompare(a.data.pubDate)).slice(0,4);
---
<Base title="Motori â€¢ News, Prove, Elettrico" description="Notizie auto, prove su strada, elettrico, guide all'acquisto.">
  <section class="grid gap-6">
    <h2 class="text-xl font-bold">Ultime News</h2>
    <div class="grid md:grid-cols-2 gap-4">
      {latestNews.map((p) => (
        <ArticleCard
          href={`${import.meta.env.BASE_URL}news/${p.slug}/`}
          cover={p.data.cover ?? `${import.meta.env.BASE_URL}images/placeholder.jpg`}
          title={p.data.title}
          excerpt={p.data.description}
          category="News"
          date={new Date(p.data.pubDate).toLocaleDateString("it-IT")}
        />
      ))}
    </div>
  </section>

  <section class="grid gap-6 mt-10">
    <h2 class="text-xl font-bold">Ultime Prove</h2>
    <div class="grid md:grid-cols-2 gap-4">
      {latestTests.map((p) => (
        <ArticleCard
          href={`${import.meta.env.BASE_URL}tests/${p.slug}/`}
          cover={p.data.cover ?? `${import.meta.env.BASE_URL}images/placeholder.jpg`}
          title={p.data.title}
          excerpt={p.data.description}
          category="Prove"
          date={new Date(p.data.pubDate).toLocaleDateString("it-IT")}
        />
      ))}
    </div>
  </section>

  <section class="grid gap-6 mt-10">
    <h2 class="text-xl font-bold">Guide</h2>
    <div class="grid md:grid-cols-2 gap-4">
      {latestGuides.map((p) => (
        <ArticleCard
          href={`${import.meta.env.BASE_URL}guides/${p.slug}/`}
          cover={p.data.cover ?? `${import.meta.env.BASE_URL}images/placeholder.jpg`}
          title={p.data.title}
          excerpt={p.data.description}
          category="Guide"
          date={new Date(p.data.pubDate).toLocaleDateString("it-IT")}
        />
      ))}
    </div>
  </section>
</Base>
